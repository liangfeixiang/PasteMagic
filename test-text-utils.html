<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬å·¥å…·å‡½æ•°æµ‹è¯•</title>
    <style>
        body { font-family: sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .container { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result-card { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        textarea, button { margin: 5px; padding: 8px; }
        button { background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¤ æ–‡æœ¬å·¥å…·å‡½æ•°æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•</h3>
            <button onclick="runCoreTests()">è¿è¡Œæµ‹è¯•</button>
            <div id="coreResults"></div>
        </div>

        <div class="test-section">
            <h3>å®æ—¶åˆ†æ</h3>
            <textarea id="textInput" rows="4" placeholder="è¾“å…¥æ–‡æœ¬è¿›è¡Œåˆ†æ...">Hello World! ä½ å¥½ä¸–ç•Œï¼Mixed text 123 @#$%</textarea>
            <button onclick="analyzeText()">åˆ†ææ–‡æœ¬</button>
            <div id="analysisResults"></div>
        </div>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿæ–‡æœ¬å·¥å…·å‡½æ•°
        const EXTENDED_PRINTABLE_REGEX = /[ -~\u00A0-\u00FF\u2000-\u206F\u20A0-\u20CF\u2100-\u214F\u2200-\u22FF\u2300-\u23FF\u2400-\u243F\u2500-\u257F\u2580-\u259F\u25A0-\u25FF\u2600-\u26FF\u2700-\u27BF\u2800-\u28FF\u2900-\u297F\u2980-\u29FF\u2A00-\u2AFF\u2B00-\u2BFF\u2C00-\u2C5F\u2C60-\u2C7F\u2C80-\u2CFF\u2D00-\u2D2F\u2D30-\u2D7F\u2D80-\u2DDF\u2E00-\u2E7F\u2E80-\u2EFF\u2F00-\u2FDF\u2FF0-\u2FFF\u3000-\u303F\u3040-\u309f\u30a0-\u30ff\u3100-\u312F\u3130-\u318F\u3190-\u319F\u31A0-\u31BF\u31C0-\u31EF\u31F0-\u31FF\u3200-\u32FF\u3300-\u33FF\u3400-\u4DBF\u4DC0-\u4DFF\u4E00-\u9FFF\uA000-\uA48F\uA490-\uA4CF\uAC00-\uD7AF\uF900-\uFAFF\uFE10-\uFE1F\uFE30-\uFE4F\uFE50-\uFE6F\uFF00-\uFFEF]/g;

        function analyzePrintableCharacters(text) {
            if (!text || typeof text !== 'string') {
                return { totalChars: 0, printableChars: 0, printableRatio: 0, isReadable: false };
            }
            
            const totalChars = text.length;
            const printableMatches = text.match(EXTENDED_PRINTABLE_REGEX);
            const printableChars = printableMatches ? printableMatches.length : 0;
            const printableRatio = totalChars > 0 ? printableChars / totalChars : 0;
            
            return {
                totalChars: totalChars,
                printableChars: printableChars,
                printableRatio: printableRatio,
                isReadable: printableRatio >= 0.5
            };
        }

        function runCoreTests() {
            const testCases = [
                { name: "è‹±æ–‡æ–‡æœ¬", text: "Hello World!", expected: true },
                { name: "ä¸­è‹±æ–‡æ··åˆ", text: "Hello ä½ å¥½ World ä¸–ç•Œ!", expected: true },
                { name: "åŒ…å«æ§åˆ¶å­—ç¬¦", text: "Hello\u0000World", expected: false },
                { name: "çº¯æ§åˆ¶å­—ç¬¦", text: "\u0000\u0001\u0002", expected: false },
                { name: "ç‰¹æ®Šç¬¦å·", text: "!@#$%^&*()", expected: true },
                { name: "ç©ºå­—ç¬¦ä¸²", text: "", expected: false }
            ];
            
            const resultsDiv = document.getElementById('coreResults');
            let html = '<h4>æµ‹è¯•ç»“æœ:</h4>';
            
            testCases.forEach(testCase => {
                const result = analyzePrintableCharacters(testCase.text);
                const passed = result.isReadable === testCase.expected;
                
                html += `
                    <div class="result-card ${passed ? 'success' : 'error'}">
                        <strong>${testCase.name}:</strong> 
                        å¯è¯»æ€§=${result.isReadable}, é¢„æœŸ=${testCase.expected}, 
                        æ¯”ä¾‹=${(result.printableRatio * 100).toFixed(1)}%
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        function analyzeText() {
            const text = document.getElementById('textInput').value;
            const result = analyzePrintableCharacters(text);
            const resultsDiv = document.getElementById('analysisResults');
            
            resultsDiv.innerHTML = `
                <div class="result-card success">
                    <h4>åˆ†æç»“æœ:</h4>
                    <div>æ€»å­—ç¬¦æ•°: ${result.totalChars}</div>
                    <div>å¯æ‰“å°å­—ç¬¦: ${result.printableChars}</div>
                    <div>å¯æ‰“å°æ¯”ä¾‹: ${(result.printableRatio * 100).toFixed(1)}%</div>
                    <div>æ˜¯å¦å¯è¯»: ${result.isReadable ? 'æ˜¯' : 'å¦'}</div>
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', runCoreTests);
    </script>
</body>
</html>