<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSAåŠ å¯†ä¿®å¤æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/3.2.1/jsencrypt.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">ğŸ” RSAåŠ å¯†ä¿®å¤æµ‹è¯•</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">é—®é¢˜æè¿°</h2>
            <div class="bg-red-50 border border-red-200 rounded p-4 mb-4">
                <p class="text-red-800"><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong> RSAåŠ å¯†å¤±è´¥ï¼Œè¯·æ£€æŸ¥å…¬é’¥æ ¼å¼æ˜¯å¦æ­£ç¡®</p>
                <p class="text-red-700 mt-2"><strong>é”™è¯¯ä½ç½®ï¼š</strong> cipherutils.js:296:13</p>
            </div>
            
            <div class="bg-blue-50 border border-blue-200 rounded p-4">
                <h3 class="font-medium text-blue-800 mb-2">æ ¹æœ¬åŸå› ï¼š</h3>
                <ul class="list-disc list-inside text-blue-700 space-y-1">
                    <li>RSAåŠ å¯†æ–¹æ³•ä¸­ä½¿ç”¨äº† <code>publicKey</code> è€Œä¸æ˜¯ <code>publicKey.value</code></li>
                    <li>RSAè§£å¯†æ–¹æ³•ä¸­ä½¿ç”¨äº† <code>privateKey</code> è€Œä¸æ˜¯ <code>privateKey.value</code></li>
                    <li>é…ç½®å¯¹è±¡ç»“æ„ä¸º <code>{ value: 'å¯†é’¥å†…å®¹', encoding: ['UTF8'] }</code></li>
                </ul>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- ä¿®å¤å‰ä»£ç  -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-red-600">âŒ ä¿®å¤å‰ï¼ˆé”™è¯¯ä»£ç ï¼‰</h2>
                <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>// RSAåŠ å¯†æ–¹æ³•
static encrypt(plaintext, config) {
  const { publicKey } = config;
  
  // é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨ publicKey å¯¹è±¡è€Œä¸æ˜¯ publicKey.value
  const encrypt = new JSEncrypt();
  encrypt.setPublicKey(publicKey); // âŒ é”™è¯¯ï¼
  
  let encrypted = encrypt.encrypt(processedPlaintext);
  if (!encrypted) {
    throw new Error('RSAåŠ å¯†å¤±è´¥ï¼Œè¯·æ£€æŸ¥å…¬é’¥æ ¼å¼æ˜¯å¦æ­£ç¡®');
  }
  return encrypted;
}

// RSAè§£å¯†æ–¹æ³•
static decrypt(ciphertext, config) {
  const { privateKey } = config;
  
  // é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨ privateKey å¯¹è±¡è€Œä¸æ˜¯ privateKey.value
  const decrypt = new JSEncrypt();
  decrypt.setPrivateKey(privateKey); // âŒ é”™è¯¯ï¼
  
  let decrypted = decrypt.decrypt(processedCiphertext);
  // ...
}</code></pre>
            </div>

            <!-- ä¿®å¤åä»£ç  -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-green-600">âœ… ä¿®å¤åï¼ˆæ­£ç¡®ä»£ç ï¼‰</h2>
                <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto"><code>// RSAåŠ å¯†æ–¹æ³•
static encrypt(plaintext, config) {
  const { publicKey } = config;
  
  // æ­£ç¡®ï¼šä½¿ç”¨ publicKey.value è·å–å®é™…å¯†é’¥å†…å®¹
  const encrypt = new JSEncrypt();
  encrypt.setPublicKey(publicKey.value); // âœ… æ­£ç¡®ï¼
  
  let encrypted = encrypt.encrypt(processedPlaintext);
  if (!encrypted) {
    throw new Error('RSAåŠ å¯†å¤±è´¥ï¼Œè¯·æ£€æŸ¥å…¬é’¥æ ¼å¼æ˜¯å¦æ­£ç¡®');
  }
  return encrypted;
}

// RSAè§£å¯†æ–¹æ³•
static decrypt(ciphertext, config) {
  const { privateKey } = config;
  
  // æ­£ç¡®ï¼šä½¿ç”¨ privateKey.value è·å–å®é™…å¯†é’¥å†…å®¹
  const decrypt = new JSEncrypt();
  decrypt.setPrivateKey(privateKey.value); // âœ… æ­£ç¡®ï¼
  
  let decrypted = decrypt.decrypt(processedCiphertext);
  // ...
}</code></pre>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ§ª å®æ—¶æµ‹è¯•</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-medium mb-2">æµ‹è¯•é…ç½®</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">æµ‹è¯•æ–‡æœ¬</label>
                            <input type="text" id="testText" value="Hello RSA Encryption!" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">å…¬é’¥</label>
                            <textarea id="publicKey" rows="4" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-sm"
                                      placeholder="è¯·è¾“å…¥RSAå…¬é’¥">-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCqGKukO1De7zhZj6+H0qtjTkVxwTCpvKe4eCZ0
FPqri0cb2JZfXJ/DgYSF6vUpwmJG8wVQZKjeGcjDOL5UlsuusFncCzWBQ7RKNUSesmQRMSGkVb1/
3j+skZ6UtW+5u09lHNsj6tQ51s1SPrCBkedbNf0Tp0GbMJDyR4e9T04ZZwIDAQAB
-----END PUBLIC KEY-----</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ç§é’¥</label>
                            <textarea id="privateKey" rows="6" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-sm"
                                      placeholder="è¯·è¾“å…¥RSAç§é’¥">-----BEGIN PRIVATE KEY-----
MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAKoYq6Q7UN7vOFmPr4fSq2NORXHB
MKm8p7h4JnQU+quLRxvYll9cn8OBhIXq9SnCYkbzBVBkqN4ZyMM4vlSWy66wWdwLNYFDtEo1RJ6y
ZBExIaRVvX/eP6yRnpS1b7m7T2Uc2yPq1DnWzVI+sIGR51s1/ROnQZswkPJHh71PThlnAgMBAAEC
gYEA45ZJG0fXsuaSRpSUtjFdQH/XjhYlcXlG1OI5tTZynE78H20M/RkHF9xq+DYAcQ6J3mFkxJ4K
2rY/JVM3IxvuQkSSogRve1Ay59wXTkkKrJisQQ5YEbwCGsoYD7JviF9+OXkT0N0pZd9mSGH51W7V
7UFzDDYQqIKXvXFuPW0CQQDTj1U5jc4xHaV3jwVFsJ0D3dqOdgDp34UrkpRIzYW72TcTWTElR7h/
P5JXm1HC15aqhbm7VmyXiBKxAiXhAkEAxXA2SY0+s5xZVfJK1VOsUKMX3vH+Q7w3oi7snTgfqxel
DlJoOajEZUEV3Dcq5XgwAUoJBHZBJuTwE/LVx5regwJBAIUjtwiWG4v1DmmDL0BTdwbN9BcL0Ob4
7jUXdEO9E4R2hlKddcWMsdhNRrxkcyJrNwc7rJowa7BGKHvqLjdCk0MCQGWFAsJ8cwxi+w1OpuEG
pLxK0vXzg9OP5yjCDkqDilPGcx8H8+knuRmV2BH9/Sz5DC0KjmG+dy6AY5mOMaMCAkEAi3X05rCe
kqgwb2qJj8VjfHnf9cUkJo3dWIy+ghLMKdQpamHrrqRhOG0HK1m6NveqcpeWd0DdcLZ+dl+dxf4P
9Q==
-----END PRIVATE KEY-----</textarea>
                        </div>
                        <button onclick="runTest()" 
                                class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded">
                            ğŸ”§ è¿è¡Œæµ‹è¯•
                        </button>
                    </div>
                </div>
                
                <div>
                    <h3 class="font-medium mb-2">æµ‹è¯•ç»“æœ</h3>
                    <div id="testResult" class="bg-gray-50 p-4 rounded min-h-[300px]">
                        <p class="text-gray-500">ç‚¹å‡»"è¿è¡Œæµ‹è¯•"æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“‹ ä¿®å¤æ€»ç»“</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="p-4 bg-green-50 rounded-lg">
                    <h3 class="font-medium text-green-800 mb-2">âœ… é—®é¢˜ä¿®å¤</h3>
                    <ul class="text-sm text-green-700 space-y-1">
                        <li>ä¿®æ­£RSAåŠ å¯†å…¬é’¥å¼•ç”¨</li>
                        <li>ä¿®æ­£RSAè§£å¯†ç§é’¥å¼•ç”¨</li>
                        <li>ç»Ÿä¸€é…ç½®å¯¹è±¡è®¿é—®æ–¹å¼</li>
                    </ul>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-medium text-blue-800 mb-2">ğŸ”§ æŠ€æœ¯è¦ç‚¹</h3>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>é…ç½®ç»“æ„ï¼š<code>{value, encoding}</code></li>
                        <li>ä½¿ç”¨ <code>.value</code> è®¿é—®å®é™…å¯†é’¥</li>
                        <li>JSEncryptéœ€è¦çº¯å¯†é’¥å­—ç¬¦ä¸²</li>
                    </ul>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg">
                    <h3 class="font-medium text-purple-800 mb-2">ğŸ¯ æµ‹è¯•éªŒè¯</h3>
                    <ul class="text-sm text-purple-700 space-y-1">
                        <li>åŠ å¯†è§£å¯†åŠŸèƒ½æ¢å¤æ­£å¸¸</li>
                        <li>CipherTestç»„ä»¶æµ‹è¯•é€šè¿‡</li>
                        <li>AutoCipherToolè‡ªåŠ¨è§£å¯†å¯ç”¨</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿé¡¹ç›®ä¸­çš„ç¼–ç å·¥å…·ç±»
        class EncodingUtils {
            static decode(value, encoding) {
                if (!encoding || encoding.includes('UTF8')) {
                    return value;
                }
                // ç®€åŒ–çš„ç¼–ç å¤„ç†
                return value;
            }
            
            static encode(value, encoding) {
                if (!encoding || encoding.includes('UTF8')) {
                    return value;
                }
                // ç®€åŒ–çš„ç¼–ç å¤„ç†
                return value;
            }
        }

        // æ¨¡æ‹Ÿä¿®å¤åçš„RSACipherç±»
        class RSACipher {
            static encrypt(plaintext, config) {
                const { publicKey, plainEncoding = ['UTF8'], cipherEncoding = ['BASE64'] } = config;
                
                if (!publicKey || !publicKey.value) {
                    throw new Error('RSAåŠ å¯†éœ€è¦æä¾›å…¬é’¥');
                }
                
                // æ˜æ–‡ç¼–ç æ–¹å¼å¤„ç†
                let processedPlaintext = plaintext;
                if (plainEncoding && plainEncoding.length > 0 && !plainEncoding.includes('UTF8')) {
                    processedPlaintext = EncodingUtils.decode(plaintext, plainEncoding);
                }
                
                // å¤„ç†å…¬é’¥ - ä¿®å¤ï¼šä½¿ç”¨ publicKey.value
                const encrypt = new JSEncrypt();
                encrypt.setPublicKey(publicKey.value); // âœ… æ­£ç¡®ï¼
                
                let encrypted = encrypt.encrypt(processedPlaintext);
                
                if (!encrypted) {
                    throw new Error('RSAåŠ å¯†å¤±è´¥ï¼Œè¯·æ£€æŸ¥å…¬é’¥æ ¼å¼æ˜¯å¦æ­£ç¡®');
                }
                
                // å¤„ç†å¯†æ–‡ç¼–ç 
                if (cipherEncoding && cipherEncoding.length > 0) {
                    if (cipherEncoding.includes('HEX')) {
                        const wordArray = CryptoJS.enc.Base64.parse(encrypted);
                        encrypted = wordArray.toString(CryptoJS.enc.Hex);
                    } else if (cipherEncoding.includes('BASE64_URLSAFE')) {
                        encrypted = encrypted.replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
                    }
                }
                
                return encrypted;
            }

            static decrypt(ciphertext, config) {
                const { privateKey, plainEncoding = ['UTF8'], cipherEncoding = ['BASE64'] } = config;
                
                if (!privateKey || !privateKey.value) {
                    throw new Error('RSAè§£å¯†éœ€è¦æä¾›ç§é’¥');
                }
                
                // å¯†æ–‡é¢„å¤„ç†
                let processedCiphertext = ciphertext;
                if (cipherEncoding && cipherEncoding.length > 0) {
                    if (cipherEncoding.includes('HEX')) {
                        const wordArray = CryptoJS.enc.Hex.parse(processedCiphertext);
                        processedCiphertext = wordArray.toString(CryptoJS.enc.Base64);
                    } else if (cipherEncoding.includes('BASE64_URLSAFE')) {
                        let base64Str = processedCiphertext.replace(/-/g, '+').replace(/_/g, '/');
                        while (base64Str.length % 4 !== 0) {
                            base64Str += '=';
                        }
                        processedCiphertext = base64Str;
                    }
                }
                
                // å¤„ç†ç§é’¥ - ä¿®å¤ï¼šä½¿ç”¨ privateKey.value
                const decrypt = new JSEncrypt();
                decrypt.setPrivateKey(privateKey.value); // âœ… æ­£ç¡®ï¼
                
                let decrypted = decrypt.decrypt(processedCiphertext);
                
                if (decrypted === false || decrypted === null) {
                    throw new Error('RSAè§£å¯†å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç§é’¥æ ¼å¼æ˜¯å¦æ­£ç¡®æˆ–å¯†æ–‡æ˜¯å¦æœ‰æ•ˆ');
                }
                
                // æ˜æ–‡ç¼–ç æ–¹å¼å¤„ç†
                if (plainEncoding && plainEncoding.length > 0 && !plainEncoding.includes('UTF8')) {
                    decrypted = EncodingUtils.encode(decrypted, plainEncoding);
                }
                
                return decrypted;
            }
        }

        // è¿è¡Œæµ‹è¯•å‡½æ•°
        function runTest() {
            const testResult = document.getElementById('testResult');
            const testText = document.getElementById('testText').value;
            const publicKey = document.getElementById('publicKey').value;
            const privateKey = document.getElementById('privateKey').value;
            
            testResult.innerHTML = '<div class="text-blue-600">ğŸ”„ æ­£åœ¨æµ‹è¯•...</div>';
            
            try {
                // åˆ›å»ºæµ‹è¯•é…ç½®
                const testConfig = {
                    publicKey: { value: publicKey, encoding: ['UTF8'] },
                    privateKey: { value: privateKey, encoding: ['UTF8'] },
                    plainEncoding: ['UTF8'],
                    cipherEncoding: ['BASE64']
                };
                
                // æµ‹è¯•åŠ å¯†
                const encrypted = RSACipher.encrypt(testText, testConfig);
                
                // æµ‹è¯•è§£å¯†
                const decrypted = RSACipher.decrypt(encrypted, testConfig);
                
                // éªŒè¯ç»“æœ
                const isSuccess = decrypted === testText;
                
                testResult.innerHTML = `
                    <div class="${isSuccess ? 'text-green-600' : 'text-red-600'}">
                        <h4 class="font-medium mb-2">${isSuccess ? 'âœ… æµ‹è¯•æˆåŠŸï¼' : 'âŒ æµ‹è¯•å¤±è´¥ï¼'}</h4>
                        <div class="space-y-2 text-sm">
                            <div><strong>åŸå§‹æ–‡æœ¬ï¼š</strong> ${testText}</div>
                            <div><strong>åŠ å¯†ç»“æœï¼š</strong> <span class="font-mono break-all">${encrypted.substring(0, 50)}...</span></div>
                            <div><strong>è§£å¯†ç»“æœï¼š</strong> ${decrypted}</div>
                            <div><strong>ä¸€è‡´æ€§éªŒè¯ï¼š</strong> ${isSuccess ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                testResult.innerHTML = `
                    <div class="text-red-600">
                        <h4 class="font-medium mb-2">âŒ æµ‹è¯•å¤±è´¥</h4>
                        <div class="text-sm">
                            <div><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong> ${error.message}</div>
                            <div class="mt-2 text-gray-600">è¯·æ£€æŸ¥å¯†é’¥æ ¼å¼æ˜¯å¦æ­£ç¡®</div>
                        </div>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>