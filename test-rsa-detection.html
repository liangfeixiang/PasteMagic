<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSAå¯†æ–‡è¯†åˆ«æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-case {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 3px;
        }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        textarea { width: 100%; min-height: 80px; margin: 5px 0; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .pattern-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” RSAå¯†æ–‡è¯†åˆ«æµ‹è¯•</h1>
        
        <div class="pattern-info">
            <h3>RSAå¯†æ–‡ç‰¹å¾åˆ†æ</h3>
            <p><strong>ç”¨æˆ·æä¾›çš„RSAå¯†æ–‡ç¤ºä¾‹:</strong></p>
            <code>A6zfp+TG4VH8Lf+xKISInZEcdc6klF5iS8kTzN1PktwE4cgEhzrbJ5dE6a/yrIoLZDIdxM6zmLzZe1h3u/YORrUTkxwusksnxzy9r7Uk3qKquR1zkBE9MdKP1BU5hkE9PP+g2EEnv+Wm46kf8MfPwohnKPnSNjCBdKskJ4fhNIpYh+2o5qqLmJhI7pvyjpr46d+2OQDSMv6xRhyRd+WsgzyudLYs8QiZrReqAQ09dDEyiJjyPrGPDGD2zsLjzHDpL6Eu9+mnGkugRYGPkgrScDySvijOoySr3nXeeimzayL61sIQ3Vjv9EvkQIQPvvHjqRonVGpfemitMuJWsUFDWw==</code>
            <p><strong>ç‰¹å¾:</strong></p>
            <ul>
                <li>é•¿åº¦: 344å­—ç¬¦</li>
                <li>Base64ç¼–ç æ ¼å¼</li>
                <li>åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€+ã€/ã€=å­—ç¬¦</li>
                <li>å…¸å‹çš„RSAåŠ å¯†ç»“æœé•¿åº¦</li>
            </ul>
        </div>

        <div class="test-case">
            <h3>æµ‹è¯•ç”¨ä¾‹1: ç”¨æˆ·æä¾›çš„RSAå¯†æ–‡</h3>
            <textarea id="rsaTest1">A6zfp+TG4VH8Lf+xKISInZEcdc6klF5iS8kTzN1PktwE4cgEhzrbJ5dE6a/yrIoLZDIdxM6zmLzZe1h3u/YORrUTkxwusksnxzy9r7Uk3qKquR1zkBE9MdKP1BU5hkE9PP+g2EEnv+Wm46kf8MfPwohnKPnSNjCBdKskJ4fhNIpYh+2o5qqLmJhI7pvyjpr46d+2OQDSMv6xRhyRd+WsgzyudLYs8QiZrReqAQ09dDEyiJjyPrGPDGD2zsLjzHDpL6Eu9+mnGkugRYGPkgrScDySvijOoySr3nXeeimzayL61sIQ3Vjv9EvkQIQPvvHjqRonVGpfemitMuJWsUFDWw==</textarea>
            <button onclick="testRSADetection1()">æµ‹è¯•è¯†åˆ«</button>
            <div id="result1"></div>
        </div>

        <div class="test-case">
            <h3>æµ‹è¯•ç”¨ä¾‹2: å…¶ä»–Base64å†…å®¹å¯¹æ¯”</h3>
            <textarea id="base64Test">SGVsbG8gV29ybGQhIOS9oOWlve+8geS4lueVjO+8gQ==</textarea>
            <button onclick="testBase64Detection()">æµ‹è¯•Base64è¯†åˆ«</button>
            <div id="result2"></div>
        </div>

        <div class="test-case">
            <h3>æµ‹è¯•ç”¨ä¾‹3: æ¨¡æ‹ŸRSAåŠ å¯†ç»“æœ</h3>
            <textarea id="rsaTest2">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCqGKukO1De7zhZj6+H0qtjTkVxwTCpvKe4eCZ0FPqri0cb2JZfXJ/DgYSF6vUpwmJG8wVQZKjeGcjDOL5UlsuusFncCzWBQ7RKNUSesmQRMSGkVb1/3j+skZ6UtW+5u09lHNsj6tQ51s1SPrCBkedbNf0Tp0GbMJDyR4e9T04ZZwIDAQAB</textarea>
            <button onclick="testRSADetection2()">æµ‹è¯•RSAè¯†åˆ«</button>
            <div id="result3"></div>
        </div>

        <div class="test-case">
            <h3>æµ‹è¯•ç”¨ä¾‹4: å†…å®¹ç±»å‹æ£€æµ‹å®Œæ•´æµ‹è¯•</h3>
            <button onclick="runCompleteTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <div id="result4"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿå†…å®¹ç±»å‹æ£€æµ‹é€»è¾‘
        async function detectContentType(content) {
            const trimmedContent = content.trim();
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºç©º
            if (!trimmedContent) {
                return 'encode';
            }

            console.log('æ£€æµ‹å†…å®¹:', trimmedContent.substring(0, 50) + '...');
            console.log('å†…å®¹é•¿åº¦:', trimmedContent.length);

            // RSAå¯†æ–‡ç‰¹æ®Šæ£€æµ‹
            if (await isLikelyRSACipher(trimmedContent)) {
                console.log('æ£€æµ‹åˆ°å¯èƒ½æ˜¯RSAå¯†æ–‡');
                return 'encrypted';
            }

            // å…¶ä»–æ£€æµ‹é€»è¾‘...
            const base64Pattern = /^[A-Za-z0-9+/]*={0,2}$/;
            if (base64Pattern.test(trimmedContent) && trimmedContent.length % 4 === 0 && trimmedContent.length > 10) {
                console.log('æ£€æµ‹åˆ°Base64ç¼–ç ');
                return 'encode';
            }

            return 'encode';
        }

        // RSAå¯†æ–‡ç‰¹å¾æ£€æµ‹
        async function isLikelyRSACipher(content) {
            const trimmedContent = content.trim();
            
            // åŸºæœ¬æ ¼å¼æ£€æŸ¥
            const base64Pattern = /^[A-Za-z0-9+/]*={0,2}$/;
            if (!base64Pattern.test(trimmedContent)) {
                return false;
            }

            // é•¿åº¦æ£€æŸ¥ - RSAåŠ å¯†ç»“æœé€šå¸¸è¾ƒé•¿
            if (trimmedContent.length < 50) {
                return false;
            }

            // é•¿åº¦ç‰¹å¾æ£€æŸ¥ - RSA-2048åŠ å¯†ç»“æœé€šå¸¸æ˜¯å›ºå®šé•¿åº¦
            const typicalRSALengths = [344, 172, 256]; // å¸¸è§çš„Base64ç¼–ç åé•¿åº¦
            if (!typicalRSALengths.includes(trimmedContent.length)) {
                console.log('é•¿åº¦ä¸ç¬¦åˆå…¸å‹RSAç‰¹å¾:', trimmedContent.length);
                // ä½†ä¸æ’é™¤å…¶ä»–é•¿åº¦çš„å¯èƒ½æ€§
            }

            // å°è¯•ä½¿ç”¨é…ç½®è¿›è¡Œè§£å¯†éªŒè¯
            try {
                // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„è§£å¯†é€»è¾‘
                // æ¨¡æ‹Ÿæ£€æŸ¥æ˜¯å¦å­˜åœ¨RSAé…ç½®
                const hasRSAConfig = await checkRSAConfigExists();
                if (hasRSAConfig) {
                    console.log('å­˜åœ¨RSAé…ç½®ï¼Œå¯èƒ½æ˜¯RSAå¯†æ–‡');
                    return true;
                }
            } catch (err) {
                console.log('RSAé…ç½®æ£€æŸ¥å¤±è´¥:', err.message);
            }

            return false;
        }

        // æ£€æŸ¥æ˜¯å¦å­˜åœ¨RSAé…ç½®
        async function checkRSAConfigExists() {
            // æ¨¡æ‹Ÿæ£€æŸ¥å­˜å‚¨ä¸­çš„é…ç½®
            try {
                // è¿™é‡Œåº”è¯¥æ˜¯å®é™…çš„StorageUtilsè°ƒç”¨
                // const { StorageUtils } = await import('../utils/storageutils');
                // const result = await StorageUtils.getItem('keyConfigs');
                // const configs = result.keyConfigs || [];
                // return configs.some(config => config.algorithm?.startsWith('RSA'));
                
                // ä¸´æ—¶è¿”å›trueç”¨äºæµ‹è¯•
                return true;
            } catch (err) {
                return false;
            }
        }

        function testRSADetection1() {
            const content = document.getElementById('rsaTest1').value;
            const resultDiv = document.getElementById('result1');
            
            detectContentType(content).then(type => {
                const isSuccess = type === 'encrypted';
                resultDiv.innerHTML = `
                    <div class="${isSuccess ? 'success' : 'error'}">
                        <strong>æ£€æµ‹ç»“æœ:</strong> ${type}<br>
                        <strong>é¢„æœŸç»“æœ:</strong> encrypted<br>
                        <strong>æ£€æµ‹${isSuccess ? 'âœ…æˆåŠŸ' : 'âŒå¤±è´¥'}:</strong> ${isSuccess ? 'æ­£ç¡®è¯†åˆ«ä¸ºRSAå¯†æ–‡' : 'æœªèƒ½è¯†åˆ«ä¸ºRSAå¯†æ–‡'}
                    </div>
                `;
            });
        }

        function testBase64Detection() {
            const content = document.getElementById('base64Test').value;
            const resultDiv = document.getElementById('result2');
            
            detectContentType(content).then(type => {
                resultDiv.innerHTML = `
                    <div class="info">
                        <strong>æ£€æµ‹ç»“æœ:</strong> ${type}<br>
                        <strong>å†…å®¹ç±»å‹:</strong> æ™®é€šBase64ç¼–ç æ–‡æœ¬<br>
                        <strong>å¤„ç†æ–¹å¼:</strong> åº”è¯¥ç”±ç¼–ç å·¥å…·å¤„ç†
                    </div>
                `;
            });
        }

        function testRSADetection2() {
            const content = document.getElementById('rsaTest2').value;
            const resultDiv = document.getElementById('result3');
            
            detectContentType(content).then(type => {
                const isSuccess = type === 'encrypted';
                resultDiv.innerHTML = `
                    <div class="${isSuccess ? 'success' : 'error'}">
                        <strong>æ£€æµ‹ç»“æœ:</strong> ${type}<br>
                        <strong>é¢„æœŸç»“æœ:</strong> encrypted<br>
                        <strong>æ£€æµ‹${isSuccess ? 'âœ…æˆåŠŸ' : 'âŒå¤±è´¥'}:</strong> ${isSuccess ? 'æ­£ç¡®è¯†åˆ«ä¸ºRSAå¯†æ–‡' : 'æœªèƒ½è¯†åˆ«ä¸ºRSAå¯†æ–‡'}
                    </div>
                `;
            });
        }

        function runCompleteTest() {
            const resultDiv = document.getElementById('result4');
            let results = '<h4>å®Œæ•´æµ‹è¯•ç»“æœ:</h4>';
            
            const testCases = [
                {
                    name: 'ç”¨æˆ·RSAå¯†æ–‡',
                    content: 'A6zfp+TG4VH8Lf+xKISInZEcdc6klF5iS8kTzN1PktwE4cgEhzrbJ5dE6a/yrIoLZDIdxM6zmLzZe1h3u/YORrUTkxwusksnxzy9r7Uk3qKquR1zkBE9MdKP1BU5hkE9PP+g2EEnv+Wm46kf8MfPwohnKPnSNjCBdKskJ4fhNIpYh+2o5qqLmJhI7pvyjpr46d+2OQDSMv6xRhyRd+WsgzyudLYs8QiZrReqAQ09dDEyiJjyPrGPDGD2zsLjzHDpL6Eu9+mnGkugRYGPkgrScDySvijOoySr3nXeeimzayL61sIQ3Vjv9EvkQIQPvvHjqRonVGpfemitMuJWsUFDWw==',
                    expected: 'encrypted'
                },
                {
                    name: 'æ™®é€šBase64',
                    content: 'SGVsbG8gV29ybGQhIOS9oOWlve+8geS4lueVjO+8gQ==',
                    expected: 'encode'
                },
                {
                    name: 'çŸ­æ–‡æœ¬',
                    content: 'Hello',
                    expected: 'encode'
                }
            ];
            
            testCases.forEach((testCase, index) => {
                detectContentType(testCase.content).then(type => {
                    const isSuccess = type === testCase.expected;
                    results += `
                        <div class="${isSuccess ? 'success' : 'error'}" style="margin-bottom: 10px;">
                            <strong>æµ‹è¯• ${index + 1} (${testCase.name}):</strong><br>
                            ç»“æœ: ${type} | é¢„æœŸ: ${testCase.expected} | ${isSuccess ? 'âœ…' : 'âŒ'}
                        </div>
                    `;
                    resultDiv.innerHTML = `<div class="info">${results}</div>`;
                });
            });
        }
    </script>
</body>
</html>