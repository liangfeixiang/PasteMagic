<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤åˆç¼–ç åŠŸèƒ½æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8">ğŸ” å¤åˆç¼–ç åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“‹ éœ€æ±‚è¯´æ˜</h2>
            <div class="prose">
                <p>ç”¨æˆ·è¦æ±‚åœ¨cipherCodingsä¸­å¢åŠ "+"å·ï¼Œæ”¯æŒå¤šä¸ªç¼–ç æ–¹å¼çš„ç»„åˆã€‚</p>
                <p class="mt-3"><strong>åŠŸèƒ½ç›®æ ‡ï¼š</strong>æ”¯æŒå¦‚"BASE64+HEX"ã€"BASE64_URLSAFE+HEX"ç­‰å¤åˆç¼–ç æ–¹å¼</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- åŠŸèƒ½æ¼”ç¤º -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ”§ åŠŸèƒ½æ¼”ç¤º</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æµ‹è¯•æ–‡æœ¬</label>
                        <input type="text" id="testText" value="Hello å¤åˆç¼–ç !" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">å¤åˆç¼–ç æ–¹å¼</label>
                        <div class="flex flex-wrap gap-2 mb-2 min-h-[40px] p-2 border rounded bg-gray-50" id="selectedEncodings">
                            <span class="text-gray-400 text-sm">æœªé€‰æ‹©ç¼–ç æ–¹å¼</span>
                        </div>
                        <select id="encodingSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="">é€‰æ‹©ç¼–ç æ–¹å¼</option>
                            <option value="BASE64">Base64</option>
                            <option value="HEX">Hex</option>
                            <option value="BASE64_URLSAFE">Base64 URL Safe</option>
                            <option value="UTF8">UTF-8</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">æ”¯æŒå¤šä¸ªç¼–ç æ–¹å¼ç»„åˆï¼Œå¦‚ï¼šBASE64+HEX</p>
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="addEncoding()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">
                            æ·»åŠ ç¼–ç 
                        </button>
                        <button onclick="clearEncodings()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded">
                            æ¸…ç©º
                        </button>
                    </div>
                    
                    <button onclick="runEncodeTest()" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded">
                        ğŸ”§ æ‰§è¡Œç¼–ç æµ‹è¯•
                    </button>
                </div>
            </div>

            <!-- æµ‹è¯•ç»“æœ -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">ğŸ§ª æµ‹è¯•ç»“æœ</h3>
                <div id="testResults" class="bg-gray-50 p-4 rounded min-h-[300px]">
                    <p class="text-gray-500">ç‚¹å‡»"æ‰§è¡Œç¼–ç æµ‹è¯•"æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“‹ ç¼–ç ç»„åˆç¤ºä¾‹</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-medium text-blue-800 mb-2">å¸¸è§ç»„åˆ</h3>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>â€¢ <code>BASE64+HEX</code> - Base64åå†è½¬Hex</li>
                        <li>â€¢ <code>HEX+BASE64</code> - Hexåå†è½¬Base64</li>
                        <li>â€¢ <code>BASE64_URLSAFE+HEX</code> - URLå®‰å…¨Base64è½¬Hex</li>
                        <li>â€¢ <code>BASE64+BASE64_URLSAFE</code> - Base64è½¬URLå®‰å…¨æ ¼å¼</li>
                    </ul>
                </div>
                
                <div class="p-4 bg-green-50 rounded-lg">
                    <h3 class="font-medium text-green-800 mb-2">åº”ç”¨åœºæ™¯</h3>
                    <ul class="text-sm text-green-700 space-y-1">
                        <li>â€¢ APIæ¥å£æ•°æ®ä¼ è¾“æ ¼å¼è½¬æ¢</li>
                        <li>â€¢ ä¸åŒç³»ç»Ÿé—´ç¼–ç æ ¼å¼å…¼å®¹</li>
                        <li>â€¢ ç‰¹æ®Šå­—ç¬¦å¤„ç†éœ€æ±‚</li>
                        <li>â€¢ å¤šå±‚ç¼–ç å®‰å…¨å¤„ç†</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ”§ æŠ€æœ¯å®ç°</h2>
            
            <div class="space-y-4">
                <div class="p-4 bg-gray-50 rounded">
                    <h3 class="font-medium mb-2">æ ¸å¿ƒä¿®æ”¹ç‚¹</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-1">UIç»„ä»¶ä¿®æ”¹</h4>
                            <ul class="text-xs text-gray-600 space-y-1">
                                <li>â€¢ æ”¯æŒæ˜¾ç¤ºå¤šä¸ªå·²é€‰ç¼–ç </li>
                                <li>â€¢ æä¾›æ·»åŠ /ç§»é™¤ç¼–ç åŠŸèƒ½</li>
                                <li>â€¢ æ”¯æŒ+å·åˆ†éš”çš„ç¼–ç å­—ç¬¦ä¸²è§£æ</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-sm font-medium text-gray-700 mb-1">å·¥å…·ç±»å¢å¼º</h4>
                            <ul class="text-xs text-gray-600 space-y-1">
                                <li>â€¢ å¤åˆç¼–ç è§£æåŠŸèƒ½</li>
                                <li>â€¢ å¤šå±‚ç¼–ç å¤„ç†é€»è¾‘</li>
                                <li>â€¢ ç¼–ç æ ¼å¼åŒ–è¾“å‡º</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="p-4 bg-purple-50 rounded">
                    <h3 class="font-medium text-purple-800 mb-2">å¤„ç†é¡ºåºè¯´æ˜</h3>
                    <p class="text-sm text-purple-700">
                        å¤åˆç¼–ç æŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºå¤„ç†ï¼Œå³å…ˆåº”ç”¨å·¦ä¾§çš„ç¼–ç æ–¹å¼ï¼Œå†åº”ç”¨å³ä¾§çš„ç¼–ç æ–¹å¼ã€‚
                        ä¾‹å¦‚ï¼š<code>BASE64+HEX</code> è¡¨ç¤ºå…ˆè¿›è¡ŒBase64ç¼–ç ï¼Œå†å°†ç»“æœè½¬æ¢ä¸ºHexæ ¼å¼ã€‚
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let selectedEncodings = [];

        // æ›´æ–°æ˜¾ç¤ºçš„å·²é€‰ç¼–ç 
        function updateSelectedEncodingsDisplay() {
            const container = document.getElementById('selectedEncodings');
            if (selectedEncodings.length === 0) {
                container.innerHTML = '<span class="text-gray-400 text-sm">æœªé€‰æ‹©ç¼–ç æ–¹å¼</span>';
                return;
            }
            
            container.innerHTML = selectedEncodings.map((encoding, index) => `
                <div class="flex items-center bg-blue-100 px-2 py-1 rounded text-sm">
                    <span>${encoding}</span>
                    <button type="button" onclick="removeEncoding(${index})" 
                            class="ml-1 text-blue-600 hover:text-blue-800 font-bold">
                        Ã—
                    </button>
                </div>
            `).join('');
        }

        // æ·»åŠ ç¼–ç 
        function addEncoding() {
            const select = document.getElementById('encodingSelect');
            const encoding = select.value;
            
            if (!encoding) {
                alert('è¯·é€‰æ‹©ç¼–ç æ–¹å¼');
                return;
            }
            
            if (selectedEncodings.includes(encoding)) {
                alert('è¯¥ç¼–ç æ–¹å¼å·²æ·»åŠ ');
                return;
            }
            
            selectedEncodings.push(encoding);
            updateSelectedEncodingsDisplay();
            select.value = '';
        }

        // ç§»é™¤ç¼–ç 
        function removeEncoding(index) {
            selectedEncodings.splice(index, 1);
            updateSelectedEncodingsDisplay();
        }

        // æ¸…ç©ºç¼–ç 
        function clearEncodings() {
            selectedEncodings = [];
            updateSelectedEncodingsDisplay();
        }

        // æ¨¡æ‹ŸEncodingUtilså·¥å…·ç±»
        class EncodingUtils {
            static encode(data, encodings = ['UTF8']) {
                let result = data;
                
                // ç¡®ä¿è¾“å…¥æ˜¯WordArrayæ ¼å¼
                if (typeof result === 'string') {
                    result = CryptoJS.enc.Utf8.parse(result);
                }
                
                // ä»å†…åˆ°å¤–åº”ç”¨ç¼–ç ï¼ˆé€†åºå¤„ç†ï¼‰
                for (let i = encodings.length - 1; i >= 0; i--) {
                    const encoding = encodings[i].toUpperCase();
                    switch (encoding) {
                        case 'UTF8':
                            break;
                        case 'HEX':
                            result = result.toString(CryptoJS.enc.Hex);
                            result = CryptoJS.enc.Hex.parse(result);
                            break;
                        case 'BASE64':
                            result = result.toString(CryptoJS.enc.Base64);
                            result = CryptoJS.enc.Base64.parse(result);
                            break;
                        case 'BASE64_URLSAFE':
                            const base64Str = result.toString(CryptoJS.enc.Base64);
                            result = base64Str.replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
                            return result;
                        default:
                            throw new Error(`ä¸æ”¯æŒçš„ç¼–ç æ–¹å¼: ${encoding}`);
                    }
                }
                
                if (result && typeof result !== 'string') {
                    result = result.toString(CryptoJS.enc.Base64);
                }
                
                return result;
            }

            static decode(data, encodings = ['UTF8']) {
                let result = data;
                
                for (const encoding of encodings) {
                    const upperEncoding = encoding.toUpperCase();
                    switch (upperEncoding) {
                        case 'UTF8':
                            if (typeof result !== 'string') {
                                result = CryptoJS.enc.Utf8.stringify(result);
                            }
                            break;
                        case 'HEX':
                            if (typeof result === 'string') {
                                result = CryptoJS.enc.Hex.parse(result);
                            }
                            break;
                        case 'BASE64':
                            if (typeof result === 'string') {
                                result = CryptoJS.enc.Base64.parse(result);
                            }
                            break;
                        case 'BASE64_URLSAFE':
                            if (typeof result === 'string') {
                                let base64Str = result.replace(/-/g, '+').replace(/_/g, '/');
                                while (base64Str.length % 4 !== 0) {
                                    base64Str += '=';
                                }
                                result = CryptoJS.enc.Base64.parse(base64Str);
                            }
                            break;
                        default:
                            throw new Error(`ä¸æ”¯æŒçš„ç¼–ç æ–¹å¼: ${encoding}`);
                    }
                }
                
                if (result && typeof result !== 'string') {
                    try {
                        result = CryptoJS.enc.Utf8.stringify(result);
                    } catch (e) {
                        result = result.toString(CryptoJS.enc.Base64);
                    }
                }
                
                return result;
            }

            static parseCompoundEncoding(encodingString) {
                if (!encodingString) return ['UTF8'];
                return encodingString.split('+').map(enc => enc.trim()).filter(enc => enc);
            }

            static formatEncoding(encodings) {
                return encodings.join('+');
            }
        }

        // æ‰§è¡Œç¼–ç æµ‹è¯•
        function runEncodeTest() {
            const testText = document.getElementById('testText').value;
            const resultsDiv = document.getElementById('testResults');
            
            if (selectedEncodings.length === 0) {
                resultsDiv.innerHTML = '<div class="text-red-600">è¯·å…ˆé€‰æ‹©ç¼–ç æ–¹å¼</div>';
                return;
            }

            try {
                // æ‰§è¡Œç¼–ç 
                const encoded = EncodingUtils.encode(testText, selectedEncodings);
                
                // æ‰§è¡Œè§£ç éªŒè¯
                const decoded = EncodingUtils.decode(encoded, [...selectedEncodings].reverse());
                
                // æ˜¾ç¤ºç»“æœ
                resultsDiv.innerHTML = `
                    <div class="space-y-3">
                        <div class="p-3 bg-green-50 rounded">
                            <h4 class="font-medium text-green-800 mb-2">âœ… ç¼–ç æµ‹è¯•æˆåŠŸ</h4>
                            <div class="text-sm space-y-1">
                                <div><strong>åŸå§‹æ–‡æœ¬ï¼š</strong> ${testText}</div>
                                <div><strong>ç¼–ç æ–¹å¼ï¼š</strong> ${EncodingUtils.formatEncoding(selectedEncodings)}</div>
                                <div><strong>ç¼–ç ç»“æœï¼š</strong> <span class="font-mono break-all">${encoded}</span></div>
                                <div><strong>è§£ç éªŒè¯ï¼š</strong> ${decoded}</div>
                                <div><strong>ä¸€è‡´æ€§æ£€æŸ¥ï¼š</strong> ${decoded === testText ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</div>
                            </div>
                        </div>
                        
                        <div class="p-3 bg-blue-50 rounded">
                            <h4 class="font-medium text-blue-800 mb-2">ğŸ“Š ç¼–ç è¿‡ç¨‹åˆ†æ</h4>
                            <div class="text-sm space-y-1">
                                <div>å¤„ç†é¡ºåºï¼š${selectedEncodings.join(' â†’ ')}</div>
                                <div>å­—ç¬¦é•¿åº¦å˜åŒ–ï¼š${testText.length} â†’ ${encoded.length}</div>
                                <div>ç¼–ç æ•ˆç‡ï¼š${Math.round((encoded.length / testText.length) * 100)}%</div>
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="p-3 bg-red-50 rounded">
                        <h4 class="font-medium text-red-800 mb-2">âŒ ç¼–ç æµ‹è¯•å¤±è´¥</h4>
                        <div class="text-sm text-red-700">
                            <div><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong> ${error.message}</div>
                            <div class="mt-2">è¯·æ£€æŸ¥ç¼–ç æ–¹å¼é€‰æ‹©æ˜¯å¦æ­£ç¡®</div>
                        </div>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== å¤åˆç¼–ç åŠŸèƒ½æµ‹è¯•é¡µé¢ ===');
            console.log('ğŸ“‹ åŠŸèƒ½è¯´æ˜ï¼š');
            console.log('   1. æ”¯æŒå¤šä¸ªç¼–ç æ–¹å¼ç»„åˆ');
            console.log('   2. æ”¯æŒ+å·åˆ†éš”çš„ç¼–ç å­—ç¬¦ä¸²');
            console.log('   3. æŒ‰ç…§ä»å·¦åˆ°å³é¡ºåºå¤„ç†');
            console.log('   4. æä¾›ç¼–ç è§£ç éªŒè¯åŠŸèƒ½');
            
            // åˆå§‹åŒ–æ˜¾ç¤º
            updateSelectedEncodingsDisplay();
        });
    </script>
</body>
</html>