<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA密钥格式统一测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8">🔐 RSA密钥格式统一测试</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">📋 需求说明</h2>
            <div class="prose">
                <p>将RSA的privateKey和publicKey存储格式与对称加密的key、iv保持一致：</p>
                <ul class="list-disc list-inside space-y-1 mt-2">
                    <li>采用对象格式：{ value: '', encoding: ['UTF8'] }</li>
                    <li>编码默认UTF8</li>
                    <li>支持编码格式选择（UTF8、HEX、BASE64）</li>
                    <li>UI界面与key、iv保持一致的布局</li>
                </ul>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- 修改前格式 -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 text-red-600">❌ 修改前格式</h3>
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium text-gray-700 mb-2">配置结构</h4>
                        <pre class="bg-gray-100 p-3 rounded text-sm overflow-x-auto">{
  name: "rsa-config",
  algorithm: "RSA",
  publicKey: "公钥内容...",  // 简单字符串
  privateKey: "私钥内容..."  // 简单字符串
}</pre>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700 mb-2">UI界面</h4>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="mb-3">
                                <label class="block text-sm font-medium mb-1">RSA 公钥</label>
                                <textarea class="w-full p-2 border rounded font-mono text-sm" rows="3" readonly>简单文本输入框</textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">RSA 私钥</label>
                                <textarea class="w-full p-2 border rounded font-mono text-sm" rows="3" readonly>简单文本输入框</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 修改后格式 -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4 text-green-600">✅ 修改后格式</h3>
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium text-gray-700 mb-2">配置结构</h4>
                        <pre class="bg-gray-100 p-3 rounded text-sm overflow-x-auto">{
  name: "rsa-config",
  algorithm: "RSA",
  publicKey: {
    value: "公钥内容...",
    encoding: ["UTF8"]
  },
  privateKey: {
    value: "私钥内容...",
    encoding: ["UTF8"]
  }
}</pre>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700 mb-2">UI界面</h4>
                        <div class="bg-gray-50 p-3 rounded">
                            <div class="mb-3">
                                <label class="block text-sm font-medium mb-1">RSA 公钥</label>
                                <div class="flex gap-2">
                                    <textarea class="flex-1 p-2 border rounded font-mono text-sm" rows="3" readonly>带编码选择的输入框</textarea>
                                    <select class="w-24 p-2 border rounded">
                                        <option>UTF-8</option>
                                        <option>Hex</option>
                                        <option>Base64</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">RSA 私钥</label>
                                <div class="flex gap-2">
                                    <textarea class="flex-1 p-2 border rounded font-mono text-sm" rows="3" readonly>带编码选择的输入框</textarea>
                                    <select class="w-24 p-2 border rounded">
                                        <option>UTF-8</option>
                                        <option>Hex</option>
                                        <option>Base64</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">🔧 主要修改点</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <div class="p-4 bg-blue-50 rounded-lg">
                        <h3 class="font-medium text-blue-800 mb-2">1. 配置初始化</h3>
                        <pre class="bg-white p-2 rounded text-xs overflow-x-auto">// 修改前
publicKey: '',
privateKey: ''

// 修改后
publicKey: {
  value: '',
  encoding: ['UTF8']
},
privateKey: {
  value: '',
  encoding: ['UTF8']
}</pre>
                    </div>

                    <div class="p-4 bg-purple-50 rounded-lg">
                        <h3 class="font-medium text-purple-800 mb-2">2. 配置验证</h3>
                        <pre class="bg-white p-2 rounded text-xs overflow-x-auto">// 修改前
if (!editedConfig.publicKey.trim())

// 修改后
if (!editedConfig.publicKey?.value?.trim())</pre>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="p-4 bg-green-50 rounded-lg">
                        <h3 class="font-medium text-green-800 mb-2">3. 密钥生成</h3>
                        <pre class="bg-white p-2 rounded text-xs overflow-x-auto">// 修改前
publicKey: publicKeyPEM,
privateKey: privateKeyPEM

// 修改后
publicKey: {
  value: publicKeyPEM,
  encoding: ['UTF8']
},
privateKey: {
  value: privateKeyPEM,
  encoding: ['UTF8']
}</pre>
                    </div>

                    <div class="p-4 bg-yellow-50 rounded-lg">
                        <h3 class="font-medium text-yellow-800 mb-2">4. UI界面</h3>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>• 添加编码格式下拉选择</li>
                            <li>• 统一布局风格</li>
                            <li>• 支持对象格式的数据绑定</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">🧪 功能测试</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-medium mb-3">测试场景</h3>
                    <div class="space-y-3">
                        <div class="border rounded p-3">
                            <h4 class="font-medium text-sm mb-2">场景1：新建RSA配置</h4>
                            <ul class="text-xs text-gray-600 space-y-1">
                                <li>• 检查默认编码是否为UTF8</li>
                                <li>• 验证对象格式初始化</li>
                                <li>• 测试编码选择功能</li>
                            </ul>
                        </div>
                        
                        <div class="border rounded p-3">
                            <h4 class="font-medium text-sm mb-2">场景2：生成RSA密钥对</h4>
                            <ul class="text-xs text-gray-600 space-y-1">
                                <li>• 验证生成的密钥格式</li>
                                <li>• 检查编码属性设置</li>
                                <li>• 测试UI数据显示</li>
                            </ul>
                        </div>
                        
                        <div class="border rounded p-3">
                            <h4 class="font-medium text-sm mb-2">场景3：配置保存与加载</h4>
                            <ul class="text-xs text-gray-600 space-y-1">
                                <li>• 验证存储格式一致性</li>
                                <li>• 测试配置回显功能</li>
                                <li>• 检查编码选项保持</li>
                            </ul>
                        </div>
                        
                        <button onclick="runFormatTests()" 
                                class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded">
                            🔧 运行格式测试
                        </button>
                    </div>
                </div>
                
                <div>
                    <h3 class="font-medium mb-3">测试结果</h3>
                    <div id="formatTestResults" class="bg-gray-50 p-4 rounded min-h-[300px]">
                        <p class="text-gray-500">点击"运行格式测试"按钮开始测试...</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
            <h2 class="text-xl font-semibold mb-4">📋 兼容性说明</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="p-4 bg-green-50 rounded-lg">
                    <h3 class="font-medium text-green-800 mb-2">✅ 向前兼容</h3>
                    <ul class="text-sm text-green-700 space-y-1">
                        <li>旧格式配置自动转换</li>
                        <li>默认值合理设置</li>
                        <li>不影响现有功能</li>
                    </ul>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg">
                    <h3 class="font-medium text-blue-800 mb-2">🔧 技术实现</h3>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>对象格式标准化</li>
                        <li>编码选项统一</li>
                        <li>UI组件重构</li>
                    </ul>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg">
                    <h3 class="font-medium text-purple-800 mb-2">🎯 用户体验</h3>
                    <ul class="text-sm text-purple-700 space-y-1">
                        <li>界面一致性提升</li>
                        <li>操作逻辑统一</li>
                        <li>配置管理简化</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 模拟配置格式转换测试
        function runFormatTests() {
            const resultsDiv = document.getElementById('formatTestResults');
            
            // 测试用例
            const testCases = [
                {
                    name: "新配置初始化",
                    test: () => {
                        const newConfig = {
                            name: "test-rsa",
                            algorithm: "RSA",
                            publicKey: {
                                value: '',
                                encoding: ['UTF8']
                            },
                            privateKey: {
                                value: '',
                                encoding: ['UTF8']
                            }
                        };
                        return newConfig.publicKey.encoding[0] === 'UTF8' && 
                               newConfig.privateKey.encoding[0] === 'UTF8';
                    }
                },
                {
                    name: "密钥生成格式",
                    test: () => {
                        const generatedConfig = {
                            publicKey: {
                                value: "generated-public-key-content",
                                encoding: ['UTF8']
                            },
                            privateKey: {
                                value: "generated-private-key-content",
                                encoding: ['UTF8']
                            }
                        };
                        return typeof generatedConfig.publicKey.value === 'string' &&
                               Array.isArray(generatedConfig.publicKey.encoding);
                    }
                },
                {
                    name: "配置验证逻辑",
                    test: () => {
                        const validConfig = {
                            publicKey: { value: "test-key", encoding: ['UTF8'] },
                            privateKey: { value: "test-private", encoding: ['UTF8'] }
                        };
                        const invalidConfig = {
                            publicKey: { value: "", encoding: ['UTF8'] },
                            privateKey: { value: "test-private", encoding: ['UTF8'] }
                        };
                        
                        const isValid = (config) => {
                            return config.publicKey?.value?.trim() && config.privateKey?.value?.trim();
                        };
                        
                        return isValid(validConfig) && !isValid(invalidConfig);
                    }
                },
                {
                    name: "编码选项支持",
                    test: () => {
                        const encodings = ['UTF8', 'HEX', 'BASE64'];
                        const config = {
                            publicKey: { value: "test", encoding: ['UTF8'] }
                        };
                        
                        // 模拟编码切换
                        config.publicKey.encoding = ['HEX'];
                        return config.publicKey.encoding[0] === 'HEX';
                    }
                }
            ];

            let resultsHtml = '<div class="space-y-3">';
            
            testCases.forEach((testCase, index) => {
                try {
                    const passed = testCase.test();
                    resultsHtml += `
                        <div class="p-3 rounded ${passed ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}">
                            <div class="flex items-center justify-between">
                                <span class="font-medium ${passed ? 'text-green-800' : 'text-red-800'}">
                                    ${testCase.name}
                                </span>
                                <span class="text-sm ${passed ? 'text-green-600' : 'text-red-600'}">
                                    ${passed ? '✅ 通过' : '❌ 失败'}
                                </span>
                            </div>
                        </div>
                    `;
                } catch (error) {
                    resultsHtml += `
                        <div class="p-3 rounded bg-red-50 border border-red-200">
                            <div class="flex items-center justify-between">
                                <span class="font-medium text-red-800">
                                    ${testCase.name}
                                </span>
                                <span class="text-sm text-red-600">
                                    ❌ 错误: ${error.message}
                                </span>
                            </div>
                        </div>
                    `;
                }
            });
            
            resultsHtml += '</div>';
            resultsDiv.innerHTML = resultsHtml;
        }
    </script>
</body>
</html>